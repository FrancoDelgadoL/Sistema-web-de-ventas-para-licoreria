@model List<UsuarioConRol>
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Usuarios</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- CSS personalizado -->
    <link href="~/css/Admin/ListarUsuarios.css" rel="stylesheet">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="sidebar shadow-sm">
                <div class="logo">
                    <h3 class="mb-1 fw-bold">EZEL <span class="text-primary">Market</span></h3>
                    <small class="text-light opacity-75">Panel de Administración</small>
                </div>

                <nav class="nav flex-column mt-4">
                    <a class="nav-link" href="/Admin/Index"><i class="bi bi-house-door me-2"></i>Inicio</a>
                    <a class="nav-link active" href="/Admin/ListarUsuarios"><i
                            class="bi bi-people me-2"></i>Usuarios</a>
                    <a class="nav-link" href="/Admin/AsignarRoles"><i class="bi bi-person-gear me-2"></i>Asignar Roles</a>
                    <a class="nav-link active" href="/Admin/ListarCupones"><i class="bi bi-ticket-perforated me-2"></i>Cupones</a>
                    <a class="nav-link" href="/Admin/Perfil"><i class="bi bi-person me-2"></i>Perfil</a>
                    <a class="nav-link" href="/Inventario/Index"><i class="bi bi-person me-2"></i>Gestion de
                        Inventario</a>
                    <button type="button" class="nav-link text-danger w-100 text-start bg-transparent border-0"
                        data-bs-toggle="modal" data-bs-target="#logoutModal">
                        <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión
                    </button>
                </nav>

                <div class="user-info mt-auto text-center pt-4 border-top border-secondary-subtle">
                    <p class="mb-1 fw-semibold">Administrador</p>
                    <small class="text-light opacity-75">Último acceso: Hoy</small>
                </div>
            </div>

            <!-- === Contenido principal === -->
            <div class="col-md-9 col-lg-10 main-content">
                <div class="card">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="bi bi-people me-2"></i>Lista de Usuarios
                        </h4>
                        <button class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i>Agregar Usuario
                        </button>
                    </div>

                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Usuario</th>
                                        <th>Nombre Completo</th>
                                        <th>Email</th>
                                        <th>Rol</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model != null && Model.Any())
                                    {
                                        foreach (var usuario in Model)
                                        {
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <img src="https://ui-avatars.com/api/?name=@(usuario.Nombre)+@(usuario.Apellido)&background=007bff&color=fff"
                                                            class="user-avatar me-3" alt="@usuario.Nombre">
                                                        <div>
                                                            <strong>@usuario.UserName</strong>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>@usuario.Nombre @usuario.Apellido</td>
                                                <td>@usuario.Email</td>
                                                <td>
                                                    <span class="badge 
                                                                @(usuario.Rol == "Administrador" ? "bg-danger" :
                                                                                                                  usuario.Rol == "Cliente" ? "bg-primary" : 
                                                                                                                  usuario.Rol == "Gerente" ? "bg-warning text-dark" : 
                                                                                                                  usuario.Rol == "Inventario" ? "bg-success" : 
                                                                                                                  "bg-secondary")">
                                                        @usuario.Rol
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="action-buttons">
                                                        <button class="btn btn-action btn-view" title="Ver detalles">
                                                            <i class="bi bi-eye"></i>
                                                        </button>
                                                        <button class="btn btn-action btn-edit" title="Editar usuario">
                                                            <i class="bi bi-pencil"></i>
                                                        </button>
                                                        <button class="btn btn-action btn-delete" data-bs-toggle="modal"
                                                            data-bs-target="#deleteModal" data-user-id="@usuario.Id"
                                                            data-user-name="@usuario.Nombre @usuario.Apellido"
                                                            data-user-email="@usuario.Email" title="Eliminar usuario">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="5" class="text-center py-4">
                                                <i class="bi bi-people display-4 text-muted d-block mb-3"></i>
                                                <p class="text-muted">No hay usuarios registrados</p>
                                                <button class="btn btn-primary">
                                                    <i class="bi bi-plus-circle me-2"></i>Agregar Usuario
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- === Modal de eliminación === -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro que deseas eliminar al usuario:</p>
                    <div class="alert alert-warning">
                        <strong id="modalUserName"></strong><br>
                        <small id="modalUserEmail"></small>
                    </div>
                    <p class="text-danger small">
                        <i class="bi bi-info-circle me-1"></i>Esta acción no se puede deshacer.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form id="deleteForm" asp-action="EliminarUsuario" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" id="deleteUserId" />
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash me-1"></i> Eliminar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const deleteModal = document.getElementById('deleteModal');

            deleteModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const userId = button.getAttribute('data-user-id');
                const userName = button.getAttribute('data-user-name');
                const userEmail = button.getAttribute('data-user-email');

                document.getElementById('modalUserName').textContent = userName;
                document.getElementById('modalUserEmail').textContent = userEmail;
                document.getElementById('deleteUserId').value = userId;
            });

            @if (TempData["Success"] != null)
                {
                    <text>
                    setTimeout(() => alert('@TempData["Success"]'), 100);
                    </text>
            }
                @if (TempData["Error"] != null)
                {
                    <text>
                    setTimeout(() => alert('Error: @TempData["Error"]'), 100);
                    </text>
            }
        });
    </script>
</body>

</html>